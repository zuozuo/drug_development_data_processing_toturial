# 从零开始理解临床试验数据：CRF → SDTM → ADaM → Define.xml

> 本教程面向医药行业小白，用最简单的语言和实际例子帮你理解整个数据处理流程。

---

## 目录

1. [先讲个故事：为什么需要这套流程？](#1-先讲个故事为什么需要这套流程)
2. [四个关键概念一句话解释](#2-四个关键概念一句话解释)
3. [完整流程图](#3-完整流程图)
4. [实战示例：一个降压药临床试验](#4-实战示例一个降压药临床试验)
5. [深入理解：ADSL 和 ADVS 的关系与派生逻辑](#5-深入理解adsl-和-advs-的关系与派生逻辑)
6. [Define.xml：数据的"说明书"](#6-definexml数据的说明书)
7. [总结](#7-总结)

---

## 1. 先讲个故事：为什么需要这套流程？

想象你是一个药监局的审评员，每天要审查几十个新药的临床试验数据。

**问题来了：**
- A公司把"年龄"叫 `AGE`，B公司叫 `NIANLING`
- A公司用"男/女"，B公司用"1/2"
- 每家公司的数据表格结构都不一样

**你会疯掉的！** 😵

所以，FDA（美国食品药品监督管理局）和 CDISC（临床数据交换标准协会）制定了统一标准：

| 标准 | 作用 | 类比 |
|------|------|------|
| **SDTM** | 统一存储临床数据的格式 | 像"普通话"，大家都能听懂 |
| **ADaM** | 统一分析数据的格式 | 像"考试答题卡"，方便打分 |
| **Define.xml** | 解释数据的说明文件 | 像"数据字典"，告诉你每列是啥意思 |

---

## 2. 四个关键概念一句话解释

### 📋 CRF（Case Report Form）—— 病例报告表

> **一句话**：医生在临床试验中填写的原始表格。

就像你去医院看病，医生在病历本上记录的内容。可能是纸质的，也可能是电子的（eCRF）。

### 📦 SDTM（Study Data Tabulation Model）—— 研究数据制表模型

> **一句话**：把乱七八糟的原始数据，整理成"标准格式"存起来。

类比：你有一堆杂乱的发票，SDTM 就是把它们按照"日期、金额、类别"整整齐齐地录入 Excel。

### 📊 ADaM（Analysis Data Model）—— 分析数据模型

> **一句话**：在 SDTM 基础上，加工成"可以直接做统计分析"的数据。

类比：SDTM 是食材（生肉、蔬菜），ADaM 是做好的菜（可以直接吃了）。

### 📖 Define.xml —— 数据定义文件

> **一句话**：一份 XML 格式的"数据说明书"，告诉审评员每个数据是什么意思。

类比：宜家家具的安装说明书，告诉你每个零件是干嘛的。

---

## 3. 完整流程图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        临床试验数据处理完整流程                               │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐
    │  临床现场  │   医生给患者做检查、记录数据
    └────┬─────┘
         │
         ▼
    ┌──────────┐
    │   CRF    │   原始数据（可能很乱、格式不统一）
    │ 病例报告表 │   例：年龄=35, 性别=男, 收缩压=145
    └────┬─────┘
         │
         │  📥 数据清洗 + 标准化映射
         ▼
    ┌──────────┐
    │  SDTM    │   标准化存储格式
    │ 制表数据  │   例：USUBJID=001, AGE=35, SEX=M, VSORRES=145
    └────┬─────┘
         │
         │  📊 派生计算 + 分析准备
         ▼
    ┌──────────┐
    │  ADaM    │   分析就绪数据
    │ 分析数据  │   例：加入基线值、计算变化值、标记分析人群
    └────┬─────┘
         │
         ├────────────────┐
         │                │
         ▼                ▼
    ┌──────────┐    ┌───────────┐
    │ 统计分析  │    │Define.xml │
    │ 表格/图形 │    │ 数据说明书 │
    └──────────┘    └───────────┘
         │                │
         └───────┬────────┘
                 │
                 ▼
          ┌────────────┐
          │  提交药监局  │
          │  (FDA/NMPA) │
          └────────────┘
```

---

## 4. 实战示例：一个降压药临床试验

让我们通过一个具体例子，看看数据是怎么一步步变化的。

### 场景设定

- **试验名称**：XX降压药III期临床试验
- **试验设计**：随机、双盲、安慰剂对照
- **主要指标**：收缩压变化

---

### 第一步：CRF 原始数据

医生在医院收集的原始数据，可能长这样：

**人口学信息表 (DM_raw)**
| 患者编号 | 姓名 | 年龄 | 性别 | 入组日期 |
|---------|------|------|------|----------|
| 001 | 张三 | 58 | 男 | 2024-01-15 |
| 002 | 李四 | 62 | 女 | 2024-01-16 |
| 003 | 王五 | 55 | 男 | 2024-01-17 |

**生命体征表 (VS_raw)**
| 患者编号 | 检查项目 | 结果 | 单位 | 检查日期 | 访视 |
|---------|---------|------|------|----------|------|
| 001 | 收缩压 | 152 | mmHg | 2024-01-15 | 筛选期 |
| 001 | 收缩压 | 148 | mmHg | 2024-01-22 | 第1周 |
| 001 | 收缩压 | 138 | mmHg | 2024-02-19 | 第4周 |
| 002 | 收缩压 | 165 | mmHg | 2024-01-16 | 筛选期 |
| 002 | 收缩压 | 155 | mmHg | 2024-01-23 | 第1周 |

**问题**：
- "男/女" 不是标准代码
- "筛选期/第1周" 不是标准访视名
- 没有唯一受试者标识符

---

### 第二步：转换为 SDTM 格式

按照 CDISC 标准，转换后的数据：

**DM 域（人口学）**
| STUDYID | USUBJID | SUBJID | AGE | AGEU | SEX | RFSTDTC |
|---------|---------|--------|-----|------|-----|---------|
| XXXBP001 | XXXBP001-001 | 001 | 58 | YEARS | M | 2024-01-15 |
| XXXBP001 | XXXBP001-002 | 002 | 62 | YEARS | F | 2024-01-16 |
| XXXBP001 | XXXBP001-003 | 003 | 55 | YEARS | M | 2024-01-17 |

**变量说明**：
| 变量名 | 含义 | 说明 |
|--------|------|------|
| STUDYID | 研究标识符 | 研究的唯一编号 |
| USUBJID | 唯一受试者标识符 | 全球唯一，格式：研究ID-受试者ID |
| SUBJID | 受试者标识符 | 研究内的编号 |
| AGE | 年龄 | 数值 |
| AGEU | 年龄单位 | YEARS=年 |
| SEX | 性别 | M=男, F=女 |
| RFSTDTC | 参考开始日期 | 首次给药日期 |

**VS 域（生命体征）**
| STUDYID | USUBJID | VSTESTCD | VSTEST | VSORRES | VSORRESU | VSDTC | VISITNUM | VISIT |
|---------|---------|----------|--------|---------|----------|-------|----------|-------|
| XXXBP001 | XXXBP001-001 | SYSBP | Systolic Blood Pressure | 152 | mmHg | 2024-01-15 | 1 | SCREENING |
| XXXBP001 | XXXBP001-001 | SYSBP | Systolic Blood Pressure | 148 | mmHg | 2024-01-22 | 2 | WEEK 1 |
| XXXBP001 | XXXBP001-001 | SYSBP | Systolic Blood Pressure | 138 | mmHg | 2024-02-19 | 5 | WEEK 4 |
| XXXBP001 | XXXBP001-002 | SYSBP | Systolic Blood Pressure | 165 | mmHg | 2024-01-16 | 1 | SCREENING |
| XXXBP001 | XXXBP001-002 | SYSBP | Systolic Blood Pressure | 155 | mmHg | 2024-01-23 | 2 | WEEK 1 |

**变量说明**：
| 变量名 | 含义 | 说明 |
|--------|------|------|
| VSTESTCD | 检查项目代码 | SYSBP=收缩压 |
| VSTEST | 检查项目名称 | 完整英文名 |
| VSORRES | 原始结果 | 检查数值 |
| VSORRESU | 原始结果单位 | mmHg=毫米汞柱 |
| VSDTC | 检查日期 | ISO 8601 格式 |
| VISITNUM | 访视编号 | 数字编号 |
| VISIT | 访视名称 | 标准化访视名 |

**关键变化**：
1. ✅ "男/女" → "M/F"（标准代码）
2. ✅ "筛选期" → "SCREENING"（标准访视名）
3. ✅ 添加了 USUBJID（全球唯一标识）
4. ✅ 日期格式统一为 ISO 8601

---

### 第三步：转换为 ADaM 格式

ADaM 是为了统计分析准备的，需要添加很多"派生变量"。

**ADSL（受试者级别分析数据集）**
| STUDYID | USUBJID | SUBJID | AGE | AGEGR1 | SEX | SAFFL | ITTFL | TRT01P | TRT01A |
|---------|---------|--------|-----|--------|-----|-------|-------|--------|--------|
| XXXBP001 | XXXBP001-001 | 001 | 58 | 50-64 | M | Y | Y | Drug A | Drug A |
| XXXBP001 | XXXBP001-002 | 002 | 62 | 50-64 | F | Y | Y | Placebo | Placebo |
| XXXBP001 | XXXBP001-003 | 003 | 55 | 50-64 | M | Y | N | Drug A | Drug A |

**新增变量说明**：
| 变量名 | 含义 | 说明 |
|--------|------|------|
| AGEGR1 | 年龄分组 | 按区间分组，便于亚组分析 |
| SAFFL | 安全性分析集标志 | Y=纳入安全性分析 |
| ITTFL | 意向治疗分析集标志 | Y=纳入ITT分析 |
| TRT01P | 计划治疗 | 随机分配的治疗组 |
| TRT01A | 实际治疗 | 实际接受的治疗组 |

**ADVS（生命体征分析数据集）**
| USUBJID | PARAMCD | PARAM | AVAL | BASE | CHG | PCHG | ADT | AVISIT | ABLFL | ANL01FL |
|---------|---------|-------|------|------|-----|------|-----|--------|-------|---------|
| XXXBP001-001 | SYSBP | Systolic BP (mmHg) | 152 | 152 | . | . | 2024-01-15 | Baseline | Y | Y |
| XXXBP001-001 | SYSBP | Systolic BP (mmHg) | 148 | 152 | -4 | -2.6 | 2024-01-22 | Week 1 | | Y |
| XXXBP001-001 | SYSBP | Systolic BP (mmHg) | 138 | 152 | -14 | -9.2 | 2024-02-19 | Week 4 | | Y |
| XXXBP001-002 | SYSBP | Systolic BP (mmHg) | 165 | 165 | . | . | 2024-01-16 | Baseline | Y | Y |
| XXXBP001-002 | SYSBP | Systolic BP (mmHg) | 155 | 165 | -10 | -6.1 | 2024-01-23 | Week 1 | | Y |

**关键派生变量说明**：
| 变量名 | 含义 | 计算方法 |
|--------|------|----------|
| AVAL | 分析值 | 用于分析的数值（通常等于原始值） |
| BASE | 基线值 | 治疗前的数值，作为比较基准 |
| CHG | 变化值 | AVAL - BASE（绝对变化） |
| PCHG | 变化百分比 | (CHG / BASE) × 100 |
| ABLFL | 基线记录标志 | Y=这条记录是基线值 |
| ANL01FL | 分析标志 | Y=纳入主要分析 |

**为什么需要这些派生变量？**

直接看统计结论：
- 患者001：收缩压从152降到138，**降低了14 mmHg（9.2%）**
- 患者002：收缩压从165降到155，**降低了10 mmHg（6.1%）**

这些计算好的数据可以直接用于：
- 画图（血压变化趋势图）
- 统计检验（t检验、方差分析）
- 生成报告表格

---

### 第四步：数据流向图解

```
          CRF原始数据
               │
    ┌──────────┼──────────┐
    │          │          │
    ▼          ▼          ▼
┌──────┐  ┌──────┐  ┌──────┐
│DM_raw│  │VS_raw│  │AE_raw│ ...更多表
└──┬───┘  └──┬───┘  └──┬───┘
   │         │         │
   │    SDTM 标准化转换  │
   │         │         │
   ▼         ▼         ▼
┌──────┐  ┌──────┐  ┌──────┐
│  DM  │  │  VS  │  │  AE  │  SDTM数据集
└──┬───┘  └──┬───┘  └──┬───┘
   │         │         │
   └────┬────┴────┬────┘
        │         │
        ▼         ▼
   ┌──────┐  ┌──────┐
   │ ADSL │  │ ADVS │        ADaM数据集
   │受试者 │  │生命体征│
   │ 级别 │  │ 分析 │
   └──────┘  └──────┘
        │         │
        ▼         ▼
   ┌─────────────────┐
   │   统计分析程序    │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │ 表格 / 图形 / 列表 │
   └─────────────────┘
```

---

## 5. 深入理解：ADSL 和 ADVS 的关系与派生逻辑

前面提到 ADaM 需要添加"派生变量"，这里详细解释 ADSL 和 ADVS 这两个核心数据集。

### 5.1 什么是"派生变量"？

**派生变量 = 根据原始数据计算出来的新变量**

它不是直接采集的，而是通过公式或规则"算"出来的。

#### 用减肥的例子理解

假设你记录体重变化：

| 日期 | 体重(kg) |
|------|----------|
| 1月1日 | 70 |
| 2月1日 | 68 |
| 3月1日 | 65 |

这些是**原始数据**（直接称出来的）。

但如果你想知道"减了多少"，就需要**派生变量**：

| 日期 | 体重(kg) | 基线体重 | 减了多少 | 减了百分之几 |
|------|----------|----------|----------|--------------|
| 1月1日 | 70 | 70 | 0 | 0% |
| 2月1日 | 68 | 70 | **-2** | **-2.9%** |
| 3月1日 | 65 | 70 | **-5** | **-7.1%** |

后面三列都是**派生变量**：
- 基线体重 = 第一次的体重（规则派生）
- 减了多少 = 当前体重 - 基线体重（计算派生）
- 减了百分之几 = 减了多少 ÷ 基线体重 × 100（计算派生）

### 5.2 ADSL 和 ADVS 分别是什么？

#### ADSL = Analysis Dataset Subject Level（受试者级别分析数据集）

**一句话**：每个患者只有一行，汇总这个患者的基本信息。

```
ADSL 就像是患者的"身份证 + 档案卡"

┌─────────────────────────────────────────────────────┐
│  患者001 的 ADSL 记录（只有1行）                      │
├─────────────────────────────────────────────────────┤
│  基本信息：58岁，男性                                │
│  分组信息：年龄组 50-64岁                            │
│  治疗信息：分到 Drug A 组                            │
│  分析集：纳入安全性分析(Y)，纳入ITT分析(Y)            │
└─────────────────────────────────────────────────────┘
```

#### ADVS = Analysis Dataset Vital Signs（生命体征分析数据集）

**一句话**：记录患者每次检查的详细数据，一次检查一行。

```
ADVS 就像是患者的"检查记录本"

┌─────────────────────────────────────────────────────┐
│  患者001 的 ADVS 记录（多行，每次检查一行）           │
├─────────────────────────────────────────────────────┤
│  第1行：基线期，血压152，是基线                       │
│  第2行：第1周，血压148，比基线降了4                   │
│  第3行：第4周，血压138，比基线降了14                  │
└─────────────────────────────────────────────────────┘
```

### 5.3 为什么需要两个数据集？

因为**统计分析有两种视角**：

| 视角 | 问题示例 | 用哪个数据集 |
|------|----------|-------------|
| **看患者整体** | 试验入组了多少男性/女性？ | ADSL |
| **看患者整体** | 各年龄组有多少人？ | ADSL |
| **看患者整体** | 有多少人完成了试验？ | ADSL |
| **看指标变化** | 血压随时间怎么变化？ | ADVS |
| **看指标变化** | 第4周血压平均降了多少？ | ADVS |
| **看指标变化** | 画血压变化趋势图 | ADVS |

### 5.4 数据从哪里来？—— 完整推导流程

#### 整体流程图

```
                    SDTM 数据（标准化存储）
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
    ┌──────┐          ┌──────┐          ┌──────┐
    │  DM  │          │  VS  │          │  EX  │
    │人口学 │          │生命体征│         │ 用药 │
    └──┬───┘          └──┬───┘          └──┬───┘
        │                  │                  │
        │                  │                  │
        ▼                  │                  │
    ┌──────────────────────┴──────────────────┴─────┐
    │                     ADSL                       │
    │              （先创建，作为基础）                │
    │  ┌─────────────────────────────────────────┐  │
    │  │ • 从 DM 取：年龄、性别                    │  │
    │  │ • 派生：年龄分组(AGEGR1)                  │  │
    │  │ • 从 EX 取：治疗组信息                    │  │
    │  │ • 派生：分析集标志(SAFFL, ITTFL)          │  │
    │  └─────────────────────────────────────────┘  │
    └──────────────────────┬────────────────────────┘
                           │
                           │ ADSL 作为"主表"被引用
                           ▼
    ┌──────────────────────────────────────────────┐
    │                     ADVS                      │
    │              （基于 VS + ADSL）                │
    │  ┌─────────────────────────────────────────┐ │
    │  │ • 从 VS 取：每次血压检查值               │ │
    │  │ • 从 ADSL 取：治疗组、分析集标志         │ │
    │  │ • 派生：基线值(BASE)                     │ │
    │  │ • 派生：变化值(CHG) = AVAL - BASE        │ │
    │  │ • 派生：分析标志(ANL01FL)                │ │
    │  └─────────────────────────────────────────┘ │
    └──────────────────────────────────────────────┘
```

#### ADSL 的派生逻辑（详细）

```
ADSL 派生规则
│
├── 直接取值（从 SDTM 搬过来）
│   ├── USUBJID ← 从 DM.USUBJID
│   ├── AGE ← 从 DM.AGE
│   └── SEX ← 从 DM.SEX
│
├── 规则派生（根据业务规则推导）
│   │
│   ├── AGEGR1（年龄分组）
│   │   └── 规则：
│   │       IF AGE < 50 THEN "<50"
│   │       IF 50 ≤ AGE < 65 THEN "50-64"
│   │       IF AGE ≥ 65 THEN "≥65"
│   │
│   ├── TRT01P（计划治疗组）
│   │   └── 来源：随机化表/EX域
│   │
│   ├── SAFFL（安全性分析集标志）
│   │   └── 规则：至少接受过一次研究药物 → Y
│   │
│   └── ITTFL（意向治疗分析集标志）
│       └── 规则：随机化且有基线后数据 → Y
```

#### ADVS 的派生逻辑（详细）

```
ADVS 派生规则
│
├── 直接取值
│   ├── USUBJID ← 从 VS.USUBJID
│   ├── AVAL ← 从 VS.VSSTRESN（检查数值）
│   └── ADT ← 从 VS.VSDTC（检查日期）
│
├── 从 ADSL 合并（每个患者的信息都一样）
│   ├── TRT01P ← 从 ADSL（治疗组）
│   ├── SAFFL ← 从 ADSL（安全性分析集标志）
│   └── AGEGR1 ← 从 ADSL（年龄分组）
│
├── 派生：确定基线
│   │
│   ├── ABLFL（基线标志）
│   │   └── 规则：治疗开始前最后一次非空检查 → Y
│   │
│   └── BASE（基线值）
│       └── 规则：取 ABLFL=Y 那条记录的 AVAL
│
└── 派生：计算变化
    │
    ├── CHG（绝对变化）
    │   └── 公式：CHG = AVAL - BASE
    │
    └── PCHG（百分比变化）
        └── 公式：PCHG = (CHG / BASE) × 100
```

### 5.5 用具体数字走一遍派生过程

#### 原始数据（SDTM VS域）

| USUBJID | 检查日期 | 血压值 | 访视 |
|---------|----------|--------|------|
| 001 | 2024-01-15 | 152 | 筛选期 |
| 001 | 2024-01-22 | 148 | 第1周 |
| 001 | 2024-02-19 | 138 | 第4周 |

#### 派生过程

```
第1步：确定基线
─────────────────
筛选期(2024-01-15)是治疗前最后一次检查
→ 这条记录标记 ABLFL = Y
→ BASE = 152（基线值）

第2步：计算每行的变化
─────────────────
筛选期：AVAL=152, BASE=152, CHG=152-152=0
第1周： AVAL=148, BASE=152, CHG=148-152=-4
第4周： AVAL=138, BASE=152, CHG=138-152=-14
```

#### 最终 ADVS 数据

| USUBJID | AVAL | BASE | CHG | PCHG | AVISIT | ABLFL |
|---------|------|------|-----|------|--------|-------|
| 001 | 152 | 152 | 0 | 0% | Baseline | **Y** |
| 001 | 148 | 152 | **-4** | -2.6% | Week 1 | |
| 001 | 138 | 152 | **-14** | -9.2% | Week 4 | |

### 5.6 ADSL 和 ADVS 的关系图解

```
┌─────────────────────────────────────────────────────────────┐
│                         ADSL                                 │
│                    （患者基本信息）                           │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ USUBJID=001, AGE=58, SEX=M, TRT01P=Drug A, SAFFL=Y │    │
│  └─────────────────────────────────────────────────────┘    │
│                           │                                  │
│              通过 USUBJID 关联（一对多）                      │
│                           │                                  │
│                           ▼                                  │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                       ADVS                          │    │
│  │                  （检查详细记录）                    │    │
│  │                                                     │    │
│  │  USUBJID=001, Week 1, 血压=148, CHG=-4             │    │
│  │  USUBJID=001, Week 4, 血压=138, CHG=-14            │    │
│  │  ...                                                │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘

关系：ADSL : ADVS = 1 : N（一个患者对应多条检查记录）
```

### 5.7 小结：ADSL vs ADVS

| 数据集 | 英文全称 | 每患者几行 | 主要内容 | 典型用途 |
|--------|----------|-----------|----------|----------|
| **ADSL** | Subject Level | **1行** | 患者基本信息、分组、分析集标志 | 人口学统计表、亚组分析 |
| **ADVS** | Vital Signs | **多行** | 每次检查的值、基线、变化 | 疗效分析、血压变化趋势图 |

**核心逻辑**：
1. **ADSL 先创建** → 作为所有 ADaM 数据集的"主表"
2. **ADVS 再创建** → 从 ADSL 获取患者信息，从 VS 获取检查数据，然后派生变化值

这样设计的好处是：**分析集标志、治疗组等信息只在 ADSL 定义一次，其他数据集直接引用，保证一致性**。

### 5.8 用关系型数据库来理解 SDTM 和 ADaM

如果你熟悉关系型数据库（如 MySQL、PostgreSQL），可以用以下类比来理解：

#### 概念对照

```
┌─────────────────────────────────────────────────────────────┐
│                      关系型数据库类比                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   SDTM 数据集 ≈ 基础表（Base Tables）                        │
│   ─────────────────────────────────────                     │
│   DM（人口学）     → 患者基本信息表                           │
│   VS（生命体征）   → 检查记录表                              │
│   EX（用药）       → 用药记录表                              │
│   AE（不良事件）   → 不良事件表                              │
│                                                             │
│                         │                                   │
│                         │ JOIN + 聚合 + 计算                │
│                         ▼                                   │
│                                                             │
│   ADaM 数据集 ≈ 视图/物化视图（Views/Materialized Views）    │
│   ─────────────────────────────────────                     │
│   ADSL  → 多表 JOIN 后，按患者聚合（类似宽表）                │
│   ADVS  → VS + ADSL JOIN，再加派生字段                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 用 SQL 理解 ADSL 的生成

```sql
-- ADSL 类似这样的视图/聚合表
CREATE VIEW ADSL AS
SELECT
    dm.USUBJID,
    dm.AGE,
    dm.SEX,
    -- 派生字段：年龄分组
    CASE
        WHEN dm.AGE < 50 THEN '<50'
        WHEN dm.AGE < 65 THEN '50-64'
        ELSE '≥65'
    END AS AGEGR1,
    -- 从 EX 表关联：治疗组
    ex.TRT01P,
    -- 派生字段：分析集标志
    CASE WHEN ex.EXDOSE > 0 THEN 'Y' ELSE 'N' END AS SAFFL
FROM DM dm
LEFT JOIN EX ex ON dm.USUBJID = ex.USUBJID;
```

#### 用 SQL 理解 ADVS 的生成

```sql
-- ADVS 类似这样的视图
CREATE VIEW ADVS AS
SELECT
    vs.USUBJID,
    vs.VSSTRESN AS AVAL,
    vs.VSDTC AS ADT,
    -- 从 ADSL 关联患者信息
    adsl.TRT01P,
    adsl.SAFFL,
    -- 窗口函数：取基线值（每个患者第一次检查的值）
    FIRST_VALUE(vs.VSSTRESN) OVER (
        PARTITION BY vs.USUBJID
        ORDER BY vs.VSDTC
    ) AS BASE,
    -- 派生计算：变化值 = 当前值 - 基线值
    vs.VSSTRESN - FIRST_VALUE(vs.VSSTRESN) OVER (
        PARTITION BY vs.USUBJID
        ORDER BY vs.VSDTC
    ) AS CHG
FROM VS vs
JOIN ADSL adsl ON vs.USUBJID = adsl.USUBJID;
```

#### 数据库概念对照表

| 关系型数据库概念 | CDISC 标准对应 | 说明 |
|-----------------|---------------|------|
| 基础表（Base Table） | SDTM 域（DM, VS, AE...） | 存储原始标准化数据 |
| 视图（View） | ADaM 数据集 | 基于基础表派生计算 |
| 物化视图（Materialized View） | ADaM 数据集（更准确） | 预先计算并保存成文件 |
| 主键（Primary Key） | USUBJID | 唯一标识每个患者 |
| 外键关联（Foreign Key JOIN） | 通过 USUBJID 关联 | 连接不同数据集 |
| 宽表（Wide Table） | ADSL | 一行包含患者所有维度信息 |
| 明细表 + 计算字段 | ADVS, ADAE 等 | 多行记录 + 派生变量 |

#### 关键区别

ADaM 与数据库视图的**唯一区别**：

| 数据库视图 | ADaM 数据集 |
|-----------|------------|
| 实时计算，不存储结果 | **预先计算好并保存成文件** |
| 查询时动态生成 | 生成后固定不变 |
| 可以随时修改定义 | 提交后不能修改 |

为什么 ADaM 要保存成文件？
- 需要提交给药监局审评
- 保证数据可追溯、可复现
- 审评员需要验证计算逻辑

**简单记忆**：
- **SDTM** = 数据库的基础表（存原始数据）
- **ADaM** = 数据库的物化视图（预计算好的分析数据）

---

## 6. Define.xml：数据的"说明书"

### 什么是 Define.xml？

当你把 SDTM 和 ADaM 数据提交给药监局时，审评员会问：
- "USUBJID 是什么意思？"
- "CHG 是怎么算出来的？"
- "SAFFL 的取值有哪些？"

**Define.xml 就是回答这些问题的文件！**

### Define.xml 包含什么？

```
Define.xml 结构
│
├── 📁 数据集定义
│   ├── DM - 人口学
│   ├── VS - 生命体征
│   ├── ADSL - 受试者级别分析数据集
│   └── ADVS - 生命体征分析数据集
│
├── 📁 变量定义
│   ├── USUBJID: 唯一受试者标识符, 文本, 必需
│   ├── AGE: 年龄, 数值, 必需
│   ├── CHG: 变化值, 数值, 派生
│   └── ...
│
├── 📁 受控术语（代码表）
│   ├── SEX: M=Male, F=Female
│   ├── VISIT: SCREENING, WEEK 1, WEEK 4...
│   └── ...
│
├── 📁 派生规则
│   ├── CHG = AVAL - BASE
│   ├── PCHG = (CHG / BASE) × 100
│   └── ...
│
└── 📁 外部文档链接
    ├── 统计分析计划 (SAP)
    ├── 数据管理计划 (DMP)
    └── ...
```

### Define.xml 示例片段

以下是 Define.xml 中描述 `CHG`（变化值）变量的简化示例：

```xml
<ItemDef OID="IT.CHG" Name="CHG" DataType="float" Length="8">
  <Description>
    <TranslatedText xml:lang="en">
      Change from Baseline
    </TranslatedText>
  </Description>

  <!-- 派生规则 -->
  <MethodRef MethodOID="MT.CHG.ADVS"/>
</ItemDef>

<!-- 派生方法定义 -->
<MethodDef OID="MT.CHG.ADVS" Name="CHG Derivation" Type="Computation">
  <Description>
    <TranslatedText xml:lang="en">
      CHG = AVAL - BASE
      Change from baseline is calculated as the analysis value
      minus the baseline value.
    </TranslatedText>
  </Description>
</MethodDef>
```

### Define.xml 的作用

| 用途 | 说明 |
|------|------|
| 📖 数据字典 | 解释每个变量的含义 |
| 🔗 可追溯性 | 说明数据从哪里来、怎么计算的 |
| ✅ 合规检查 | 药监局验证数据是否符合标准 |
| 🔍 审评导航 | 帮助审评员快速找到需要的数据 |

---

## 7. 总结

### 一张图总结整个流程

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   临床现场           数据标准化             分析与提交           │
│                                                                 │
│   ┌─────┐           ┌─────┐              ┌─────┐               │
│   │ CRF │  ──────▶  │SDTM │  ──────▶    │ADaM │               │
│   └─────┘           └─────┘              └─────┘               │
│   原始数据           标准存储              分析就绪              │
│   (乱)              (整齐)               (可用)                │
│                                             │                   │
│                                             ▼                   │
│                     ┌─────────────────────────────────┐        │
│                     │         提交包                   │        │
│                     │  ┌──────┐ ┌──────┐ ┌──────────┐ │        │
│                     │  │ SDTM │ │ ADaM │ │Define.xml│ │        │
│                     │  │ 数据 │ │ 数据 │ │  说明书  │ │        │
│                     │  └──────┘ └──────┘ └──────────┘ │        │
│                     └─────────────────────────────────┘        │
│                                             │                   │
│                                             ▼                   │
│                                        ┌─────────┐             │
│                                        │ 药监局  │             │
│                                        │  审评   │             │
│                                        └─────────┘             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 关键要点回顾

| 概念 | 一句话理解 | 核心作用 |
|------|-----------|----------|
| **CRF** | 医生填的原始表格 | 收集数据 |
| **SDTM** | 标准化的存储格式 | 统一数据结构 |
| **ADaM** | 分析就绪的数据格式 | 便于统计分析 |
| **Define.xml** | 数据的说明书 | 解释数据含义 |

### 为什么这套流程很重要？

1. **全球通用**：不管哪个国家、哪个公司，都用同样的标准
2. **提高效率**：审评员不用猜数据是什么意思
3. **保证质量**：有标准就能自动检查数据是否合规
4. **可追溯**：从最终结果可以追溯到原始数据

---

## 附录：常用术语表

| 英文缩写 | 英文全称 | 中文含义 |
|---------|----------|----------|
| CDISC | Clinical Data Interchange Standards Consortium | 临床数据交换标准协会 |
| CRF | Case Report Form | 病例报告表 |
| SDTM | Study Data Tabulation Model | 研究数据制表模型 |
| ADaM | Analysis Data Model | 分析数据模型 |
| FDA | Food and Drug Administration | 美国食品药品监督管理局 |
| NMPA | National Medical Products Administration | 国家药品监督管理局 |
| DM | Demographics | 人口学域 |
| VS | Vital Signs | 生命体征域 |
| AE | Adverse Events | 不良事件域 |
| ADSL | Subject-Level Analysis Dataset | 受试者级别分析数据集 |
| USUBJID | Unique Subject Identifier | 唯一受试者标识符 |

---

> 📚 **扩展阅读**
> - [CDISC 官网](https://www.cdisc.org/)
> - [FDA 电子提交指南](https://www.fda.gov/drugs/electronic-regulatory-submission-and-review/electronic-common-technical-document-ectd)

---

*本教程由 AI 辅助生成，如有疑问请咨询专业人士。*
