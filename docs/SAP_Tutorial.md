# 统计分析计划（SAP）完全指南：临床试验的"游戏规则书"

> 本文档面向完全没有接触过 SAP 的小白，用最通俗的语言解释什么是 SAP、为什么需要它、以及它包含哪些内容。

---

## 目录

1. [一个故事：为什么需要 SAP？](#1-一个故事为什么需要-sap)
2. [SAP 是什么？一句话解释](#2-sap-是什么一句话解释)
3. [SAP 在整个流程中的位置](#3-sap-在整个流程中的位置)
4. [深入理解：什么是"数据库锁定"？](#4-深入理解什么是数据库锁定)
5. [深入理解：统计师根据什么写 SAP？](#5-深入理解统计师根据什么写-sap)
6. [SAP 的完整结构](#6-sap-的完整结构)
7. [核心内容详解（一）：分析人群](#7-核心内容详解一分析人群)
8. [核心内容详解（二）：统计方法](#8-核心内容详解二统计方法)
9. [核心内容详解（三）：缺失数据处理](#9-核心内容详解三缺失数据处理)
10. [核心内容详解（四）：多重比较](#10-核心内容详解四多重比较)
11. [SAP vs Protocol：有什么区别？](#11-sap-vs-protocol有什么区别)
12. [一个完整的 SAP 示例](#12-一个完整的-sap-示例)
13. [SAP 的时间节点](#13-sap-的时间节点)
14. [常见问题](#14-常见问题)
15. [总结](#15-总结)

---

## 1. 一个故事：为什么需要 SAP？

### 想象你是一个裁判

假设你是一场足球比赛的裁判，比赛结束后：

```
❌ 不好的情况（没有提前定规则）：

比赛结束，A 队进了 3 球，B 队进了 2 球。

A 队说："我们赢了！进球多的赢！"
B 队说："不对！我们控球率高，控球率高的赢！"
A 队说："那不算！应该看射门次数！"
B 队说："应该看角球数量！"

吵来吵去，没完没了...
```

```
✅ 正确的做法（提前定好规则）：

比赛前就写好规则：
"90 分钟内，进球多的队伍获胜"

比赛结束，A 队 3:2 获胜，没有争议。
```

### 临床试验也是一样

```
❌ 没有 SAP 的问题：

做完试验，新药组血压降了 10 mmHg，安慰剂组降了 8 mmHg。

统计师 A 说："用 t 检验，p = 0.06，不显著，药无效"
统计师 B 说："用 ANCOVA，p = 0.04，显著，药有效！"
统计师 C 说："用非参数检验..."

到底听谁的？
```

```
✅ 有 SAP 的做法：

试验开始前（或数据库锁定前）就写好：
"主要终点用 ANCOVA 分析，α = 0.05"

分析时严格按 SAP 执行，结果没有争议。
```

### SAP 就是临床试验的"游戏规则书"

在看到数据之前，把所有分析规则写清楚，防止事后"改规则"来凑出想要的结果。

---

## 2. SAP 是什么？一句话解释

**SAP = Statistical Analysis Plan = 统计分析计划**

> **一句话定义**：在分析数据之前，详细写好"怎么分析"的计划书。

### 类比理解

| 场景 | 类比 |
|------|------|
| 考试 | SAP 就像"考试大纲"，提前告诉你考什么、怎么评分 |
| 做菜 | SAP 就像"菜谱"，写好用什么食材、怎么烹饪 |
| 体育比赛 | SAP 就像"比赛规则"，提前规定怎么算赢 |
| 法律 | SAP 就像"法律条文"，提前规定什么合法什么违法 |

### SAP 回答的核心问题

```
SAP 要回答的问题：
─────────────────────

1. 分析谁？
   → 哪些病人纳入分析？（分析人群）

2. 分析什么？
   → 主要看哪个指标？（主要终点）
   → 次要看哪些指标？（次要终点）

3. 怎么分析？
   → 用什么统计方法？（t检验？ANCOVA？）
   → 缺失数据怎么处理？
   → 多个指标怎么校正？

4. 什么标准算成功？
   → p < 0.05 就算显著？
   → 疗效差异要多大才有意义？
```

---

## 3. SAP 在整个流程中的位置

### 时间线

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           临床试验时间线                                  │
└─────────────────────────────────────────────────────────────────────────┘

    试验设计        试验执行          数据库锁定        统计分析        提交
       │              │                  │               │             │
       ▼              ▼                  ▼               ▼             ▼
  ┌─────────┐    ┌─────────┐       ┌─────────┐     ┌─────────┐    ┌─────────┐
  │Protocol │    │ 入组    │       │  锁定   │     │  执行   │    │  提交   │
  │ 试验方案 │    │ 随访    │       │  数据库 │     │  SAP   │    │  报告   │
  └─────────┘    │ 检查    │       └─────────┘     └─────────┘    └─────────┘
       │         └─────────┘            ▲               │
       │                                │               │
       │         ┌─────────┐            │               │
       └────────▶│   SAP   │────────────┘               │
                 │统计分析计划│         必须在锁定前完成     │
                 └─────────┘                            │
                      │                                 │
                      └─────────────────────────────────┘
                              SAP 指导统计分析
```

### 关键时间点

| 时间点 | 发生什么 | SAP 状态 |
|--------|---------|---------|
| 试验开始前 | Protocol 定稿 | SAP 开始起草 |
| 试验进行中 | 病人入组、随访 | SAP 持续完善 |
| **数据库锁定前** | 最后一个病人完成随访 | **SAP 必须定稿** ⚠️ |
| 数据库锁定后 | 开始统计分析 | 严格按 SAP 执行 |
| 分析完成后 | 撰写报告 | SAP 作为附录提交 |

### 为什么必须在锁定前定稿？

```
锁定前 vs 锁定后
─────────────────

锁定前：还没看到完整数据
       → 写 SAP 是"预先规定"
       → 公正、无偏

锁定后：已经看到数据了
       → 再改 SAP 就是"事后诸葛亮"
       → 可能根据结果调整方法来凑出想要的结论
       → 这叫"数据操纵"，是学术不端！
```

---

## 4. 深入理解：什么是"数据库锁定"？

前面多次提到"SAP 必须在数据库锁定前完成"，但到底什么是"数据库锁定"？为什么这个时间点如此重要？本节详细解释这个关键概念。

### 4.1 数据库锁定的定义

**数据库锁定（Database Lock，简称 DBL）** 就是字面意思：把存放临床试验数据的数据库"锁起来"，不允许再做任何修改。

### 4.2 用考试来类比

```
想象一场考试：

┌─────────────────────────────────────────────────────────────┐
│                                                             │
│   考试进行中              收卷                考试结束后     │
│   ─────────              ────                ──────────     │
│   学生在答题              老师把卷子收走        开始批卷      │
│   可以修改答案            封存试卷             不能再改答案   │
│   可以检查                                    只能看结果     │
│                              ▲                              │
│                              │                              │
│                        这就是"锁定"                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

临床试验的"数据库锁定"就像考试"收卷"：
- **锁定前**：数据还在收集、核查、修改中
- **锁定后**：数据被"封存"，不能再改，开始正式分析

### 4.3 为什么要"锁定"？—— 防止作弊！

```
❌ 如果不锁定会发生什么？

1. 统计师开始分析数据
2. 发现结果不太好（p = 0.08，不显著）
3. 有人说："这个病人的数据好像录错了，改一下"
4. 改完后，p = 0.04，显著了！
5. 药物"有效"了

这就是数据操纵，是学术造假！
```

```
✅ 有了锁定机制：

1. 数据核查完毕，确认无误
2. 正式锁定，任何人都不能改
3. 统计师开始分析
4. 不管结果好不好，数据就是这些

结果公正、可信！
```

### 4.4 锁定前后的区别

| 方面 | 锁定前 | 锁定后 |
|------|--------|--------|
| **数据修改** | 可以修改、更正错误 | 完全禁止修改 |
| **数据核查** | 正在进行中 | 已经完成 |
| **看到数据** | 只有数据管理看到部分 | 统计师可以看到全部 |
| **SAP 状态** | 可以调整 | 必须已经定稿 |
| **揭盲状态** | 还是盲态（不知道谁吃的真药） | 可以揭盲分析 |

### 4.5 为什么 SAP 必须在锁定前完成？

核心原因：**防止"看答案后改规则"**

```
场景类比：足球比赛
───────────────────

❌ 错误做法：
比赛结束，A队 2:1 领先
A队说："进球多的赢！"
B队说："不对！我们控球率高，控球率高的赢！"

这叫"事后改规则"，不公平！

✅ 正确做法：
比赛前就写好："进球多的赢"
比赛结束，A队 2:1 获胜，没有争议
```

SAP 也是一样：

```
❌ 如果锁定后才写 SAP：

1. 看到数据：新药组降压 10 mmHg，安慰剂组降压 8 mmHg
2. 用 t 检验：p = 0.06，不显著
3. 统计师想："换个方法试试？"
4. 用 ANCOVA：p = 0.04，显著了！
5. 在 SAP 里写："主要分析用 ANCOVA"
6. 对外宣称"药物有效"

但这是挑了一个"能凑出好结果"的方法！
```

```
✅ 锁定前就定好 SAP：

1. SAP 写好："主要分析用 ANCOVA"
2. 数据库锁定
3. 用 ANCOVA 分析：p = 0.04
4. 结论：药物有效

方法是预先规定的，不是看了数据才选的，结果可信！
```

### 4.6 完整时间线图解

```
┌─────────────────────────────────────────────────────────────────────┐
│                        临床试验完整时间线                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  试验设计    招募病人    治疗随访    数据核查    统计分析    提交报告  │
│     │          │          │          │          │          │       │
│     ▼          ▼          ▼          ▼          ▼          ▼       │
│  ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐       │
│  │方案 │   │入组 │   │吃药 │   │核查 │   │分析 │   │报告 │       │
│  │定稿 │   │病人 │   │检查 │   │数据 │   │数据 │   │结果 │       │
│  └─────┘   └─────┘   └─────┘   └─────┘   └─────┘   └─────┘       │
│     │                            │          │                      │
│     │         写 SAP             │          │                      │
│     └────────────────────────────┤          │                      │
│                                  │          │                      │
│                               ┌──┴──┐       │                      │
│                               │数据库│       │                      │
│                               │锁定 │       │                      │
│                               │ DBL │       │                      │
│                               └──┬──┘       │                      │
│                                  │          │                      │
│         ◄─── SAP 必须完成 ───►   │   ◄── 按 SAP 执行 ──►           │
│                                  │                                  │
│         可以看到部分数据          │   可以看到全部数据               │
│         但不知道分组结果          │   知道谁吃真药谁吃假药            │
│         可以调整 SAP             │   不能改 SAP                     │
│                                  │                                  │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.7 用"考试"类比整个过程

把临床试验想象成一场"考试"：

| 考试环节 | 临床试验对应 | 说明 |
|---------|-------------|------|
| 出考题 | 写 Protocol 和 SAP | 规定考什么、怎么评分 |
| 学生答题 | 病人参加试验 | 收集数据 |
| 收卷封存 | **数据库锁定** | 数据不能再改 |
| 批卷 | 统计分析 | 按预定规则评分 |
| 公布成绩 | 提交报告 | 告诉药监局结果 |

**SAP 必须在"收卷"之前写好**，否则就是"看了答案再定评分标准"，不公平！

### 4.8 小结

> **数据库锁定 = 把试验数据"封存"，锁定后不能再改任何数据。**
>
> **SAP 必须在锁定前完成 = 在"开奖"之前，先把"中奖规则"写死，防止有人看了结果再改规则。**

这样做的目的是保证临床试验结果的**公正性**和**可信度**，让药监局和公众相信：药物的疗效是真实的，不是"凑"出来的。

---

## 5. 深入理解：统计师根据什么写 SAP？

前面解释了 SAP 必须在数据库锁定前完成，但你可能会问：**统计师是根据什么来写 SAP 的？为什么不能等结果出来后选择一个对自己最有利的方法？**

这一章详细解答这个问题。

### 5.1 统计师写 SAP 的三大依据

#### 依据一：科学原理和行业惯例

```
不同类型的数据，有"标准"的分析方法
──────────────────────────────────────

这就像：
• 测量身高 → 用尺子（不是用秤）
• 测量体重 → 用秤（不是用温度计）

临床试验也一样：
• 比较两组的血压变化 → 用 ANCOVA（业界公认的标准方法）
• 比较两组的有效率   → 用卡方检验
• 比较两组的生存时间 → 用 Log-rank 检验

这些不是统计师"选"的，而是几十年来科学界积累的共识。
用错方法，药监局审评员一眼就能看出来！
```

#### 依据二：试验方案（Protocol）

```
Protocol 已经规定了大方向
─────────────────────────

Protocol（试验方案）在试验开始前就定好了：
• 主要终点是什么？（比如：第4周血压变化）
• 怎么测量？（坐位血压，休息5分钟后测）
• 样本量怎么算的？（假设血压差异5mmHg，需要200人）

SAP 只是把 Protocol 里的统计部分"展开写详细"。
统计师不能随意改变 Protocol 规定的内容。
```

#### 依据三：监管机构的指南

```
FDA/NMPA 有官方指南
────────────────────

药监局发布了很多指导原则，告诉你：
• 降压药试验应该怎么设计
• 主要终点应该怎么分析
• 缺失数据应该怎么处理

统计师必须按这些指南来写，否则审评时会被打回来。

例如：FDA 指南明确说，降压药主要终点应该用 ANCOVA，
     校正基线血压和中心效应。

统计师不能说"我想用 t 检验"——那不符合指南要求！
```

### 5.2 为什么不能等结果出来再写 SAP？—— 有人监督！

#### 临床试验不是统计师一个人的事

```
参与方和监督机制
─────────────────────────────────────────────────────────────

  申办方（药企）──────► 想证明药有效
       │
       │ 但是被多方监督
       ▼
  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐
  │ 药监局  │  │伦理委员会│  │独立统计师│  │ 学术期刊 │
  │ (FDA)  │  │  (IRB)  │  │ (IDMC)  │  │  审稿人  │
  └─────────┘  └─────────┘  └─────────┘  └─────────┘
       │            │            │            │
       └────────────┴────────────┴────────────┘
                         │
                    都会审查 SAP
```

### 5.3 具体的防作弊机制

#### 机制 1：SAP 有签字日期

```
SAP 封面会写：

    统计分析计划
    版本：1.0
    定稿日期：2024-01-15  ← 这个日期
    签字：XXX（统计负责人）
    签字：XXX（医学负责人）

数据库锁定日期：2024-03-01

药监局会检查：SAP 日期必须早于锁定日期！
如果 SAP 日期是 2024-03-02，审评员会问：
"你是不是看了数据才写的 SAP？"
```

#### 机制 2：版本控制和审计追踪

```
所有修改都有记录
─────────────────

SAP 版本历史：
v0.1  2023-10-01  初稿
v0.2  2023-11-15  内部审核修改
v0.3  2023-12-20  医学团队意见修改
v1.0  2024-01-15  定稿 ← 锁定前
───────────────────────────────────
v1.1  2024-03-05  修正笔误 ← 锁定后的任何修改都要解释原因

如果锁定后有重大修改（比如换分析方法），
必须写修正案，说明为什么要改，
而且会被药监局重点审查。
```

#### 机制 3：独立数据监查委员会（IDMC）

```
有"第三方裁判"在场
────────────────────

很多重要试验会设立 IDMC（Independent Data Monitoring Committee）：
• 由独立的外部专家组成
• 可以在试验中期看到揭盲数据
• 申办方的统计师看不到！

IDMC 的作用：
• 监督试验安全性
• 确保数据完整性
• 如果发现有人作弊，可以终止试验

统计师想作弊？IDMC 在盯着呢！
```

#### 机制 4：药监局的审评

```
药监局会仔细检查
─────────────────

审评员会问：
1. SAP 定稿日期是什么时候？（必须早于锁定）
2. 锁定后有没有修改 SAP？（如果有，为什么？）
3. 分析方法是否符合指南？（不符合要解释）
4. 敏感性分析结果一致吗？（如果主分析和敏感性分析结论不同，会被质疑）

如果发现有"凑结果"的嫌疑，整个申请可能被拒！
```

### 5.4 一个形象的比喻：高考

```
就像高考一样
────────────

高考前：
• 考试大纲早就公布了（相当于 Protocol）
• 评分标准早就定好了（相当于 SAP）
• 考生不知道具体考题（相当于不知道最终数据）

高考后：
• 按照既定标准批卷（相当于按 SAP 分析）
• 不能因为某道题大家都错了，就临时改评分标准

如果教育部说"看了答案再定评分标准"：
• 会被全社会质疑
• 没有公信力
• 高考制度崩溃

临床试验也是一样的道理！
```

### 5.5 如果作弊会怎样？

| 后果类型 | 具体后果 |
|---------|---------|
| **申请被拒** | 药监局拒绝批准上市，前期投入全部白费 |
| **学术造假** | 论文被撤稿，学术声誉毁于一旦 |
| **法律责任** | 可能面临欺诈指控和巨额罚款 |
| **行业禁入** | 相关人员可能被禁止从事药物研发 |

### 5.6 小结

| 问题 | 答案 |
|------|------|
| 统计师根据什么写 SAP？ | 科学原理 + Protocol + 监管指南 |
| 为什么不能看结果再写？ | 有签字日期、版本控制、独立监查、药监局审评 |
| 如果作弊会怎样？ | 申请被拒、学术造假、法律责任 |

> **一句话总结**：统计师写 SAP 不是"自由发挥"，而是根据科学共识和监管要求来写的。整个过程有多方监督，作弊会被发现，后果很严重。

---

## 6. SAP 的完整结构

### 典型目录

```
SAP 目录结构
─────────────────

1. 引言
   1.1 研究背景
   1.2 研究目的
   1.3 研究设计概述

2. 研究终点
   2.1 主要终点
   2.2 次要终点
   2.3 探索性终点

3. 分析人群
   3.1 全分析集（FAS/ITT）
   3.2 符合方案集（PPS）
   3.3 安全性分析集（SS）

4. 统计方法
   4.1 一般原则
   4.2 样本量计算
   4.3 主要疗效分析
   4.4 次要疗效分析
   4.5 安全性分析

5. 缺失数据处理
   5.1 缺失数据类型
   5.2 填补方法

6. 敏感性分析
   6.1 主要分析的敏感性
   6.2 不同假设下的分析

7. 亚组分析
   7.1 预设亚组
   7.2 分析方法

8. 统计输出
   8.1 表格清单
   8.2 图形清单
   8.3 数据列表清单

9. 附录
   9.1 模板表格（Shell Tables）
   9.2 引用文献
```

### 各部分的重要性

```
┌─────────────────────────────────────────────────────────────┐
│                     SAP 各部分重要性                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ⭐⭐⭐⭐⭐ 最重要                                          │
│   • 主要终点的统计方法                                       │
│   • 分析人群定义                                            │
│   • 缺失数据处理                                            │
│                                                             │
│   ⭐⭐⭐⭐ 很重要                                            │
│   • 次要终点分析                                            │
│   • 多重比较校正                                            │
│   • 敏感性分析                                              │
│                                                             │
│   ⭐⭐⭐ 重要                                                │
│   • 亚组分析                                                │
│   • 安全性分析                                              │
│   • 统计输出规格                                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 7. 核心内容详解（一）：分析人群

### 什么是分析人群？

**不是所有入组的病人都会被纳入最终分析**，需要根据不同目的定义不同的"分析人群"。

### 三大常用分析人群

```
┌─────────────────────────────────────────────────────────────────────┐
│                        三大分析人群                                  │
└─────────────────────────────────────────────────────────────────────┘

                    所有签署知情同意的病人
                           │
                           ▼
                    ┌─────────────┐
                    │   随机化    │
                    └──────┬──────┘
                           │
         ┌─────────────────┼─────────────────┐
         │                 │                 │
         ▼                 ▼                 ▼
    ┌─────────┐      ┌─────────┐      ┌─────────┐
    │  FAS    │      │   PPS   │      │   SS    │
    │ 全分析集 │      │符合方案集│      │安全性集 │
    └─────────┘      └─────────┘      └─────────┘
         │                 │                 │
         ▼                 ▼                 ▼
    所有随机化        完全按方案        至少接受过
    的受试者          完成的受试者      一次治疗的受试者
```

### 详细定义

| 分析人群 | 英文 | 定义 | 用途 |
|---------|------|------|------|
| **FAS/ITT** | Full Analysis Set / Intention-to-Treat | 所有随机化且至少有一次基线后数据的受试者 | **主要疗效分析**（最常用） |
| **PPS** | Per-Protocol Set | 完全按照方案完成试验、无重大违规的受试者 | 敏感性分析 |
| **SS** | Safety Set | 至少接受过一次研究药物的受试者 | 安全性分析 |

### 为什么用 FAS/ITT 做主要分析？

```
举例：100 人随机化
─────────────────────

         新药组 50 人                安慰剂组 50 人
              │                           │
              │                           │
         5 人因副作用退出               2 人失访
              │                           │
              ▼                           ▼
         完成 45 人                   完成 48 人


❌ 如果只分析"完成的人"（PPS）：
   新药组副作用大 → 更多人退出 → 剩下的都是耐受好的
   结果会高估新药疗效，不公平！

✅ 用 ITT 分析（所有随机化的人）：
   不管完没完成，都按原来分组分析
   更真实反映"真实世界"的效果
```

### SAP 中的写法示例

```
3.1 全分析集（Full Analysis Set, FAS）

定义：所有随机化的受试者，且至少有一次基线后主要终点评估数据。

排除标准：
• 从未服用过研究药物
• 无任何基线后疗效数据
• 入组后发现不符合入选标准的关键条款

FAS 将作为主要疗效分析的主要分析人群。
```

---

## 8. 核心内容详解（二）：统计方法

### 常用统计方法速览

```
根据数据类型选择统计方法
──────────────────────────

数据类型              常用方法                  举例
─────────────────────────────────────────────────────────
连续变量              t 检验                   血压、体重
（数值）              ANCOVA                   基线校正后的比较
                     重复测量 ANOVA            多时间点比较
                     混合效应模型              纵向数据分析

分类变量              卡方检验                 有效/无效
（比例）              Fisher 精确检验          小样本
                     Logistic 回归            多因素调整

生存数据              Kaplan-Meier             生存曲线
（时间）              Log-rank 检验            组间比较
                     Cox 回归                 多因素调整
```

### ANCOVA 是什么？（最常用）

**ANCOVA = Analysis of Covariance = 协方差分析**

```
为什么用 ANCOVA？
─────────────────

问题：比较新药组和安慰剂组的血压下降幅度

简单的想法：直接比较两组的"第 4 周血压 - 基线血压"
           用 t 检验

更好的方法：用 ANCOVA

为什么 ANCOVA 更好？

假设两组病人基线不完全平衡：
• 新药组：基线血压平均 155 mmHg
• 安慰剂组：基线血压平均 150 mmHg

基线越高，下降空间越大，对新药组不公平！

ANCOVA 可以"校正"基线的影响，更公平地比较。
```

### SAP 中统计方法的写法

```
4.3 主要疗效分析

4.3.1 主要终点
第 4 周收缩压（SBP）相对基线的变化值（CHG）

4.3.2 统计模型
采用协方差分析（ANCOVA）模型：

    CHG = μ + TRT + CENTER + BASE + ε

其中：
• CHG：因变量，SBP 变化值
• μ：总体均值
• TRT：治疗组效应（新药 vs 安慰剂）
• CENTER：研究中心效应（固定效应）
• BASE：基线 SBP（协变量）
• ε：随机误差

4.3.3 假设检验
• 零假设 H₀：μ新药 - μ安慰剂 = 0
• 备择假设 H₁：μ新药 - μ安慰剂 ≠ 0
• 显著性水平：α = 0.05（双侧）

4.3.4 估计量
• 各组最小二乘均值（LS Mean）及 95% CI
• 组间差异的点估计及 95% CI
• p 值
```

---

## 9. 核心内容详解（三）：缺失数据处理

### 为什么会有缺失数据？

```
临床试验中缺失数据的常见原因
──────────────────────────────

1. 受试者退出
   • 副作用无法耐受
   • 疗效不佳主动退出
   • 失访（联系不上）
   • 死亡

2. 检查缺失
   • 某次访视没来
   • 某项检查漏做
   • 样本丢失/不合格

3. 数据问题
   • 记录错误被删除
   • 不符合逻辑被剔除
```

### 常用填补方法

| 方法 | 英文 | 原理 | 优缺点 |
|------|------|------|--------|
| **LOCF** | Last Observation Carried Forward | 用最后一次观测值填补后续缺失 | 简单但可能有偏 |
| **BOCF** | Baseline Observation Carried Forward | 用基线值填补缺失 | 保守估计 |
| **MI** | Multiple Imputation | 多重插补，产生多个填补数据集 | 较准确但复杂 |
| **MMRM** | Mixed Model for Repeated Measures | 混合效应模型，不需要填补 | 目前最推荐 |

### LOCF 图解

```
LOCF = Last Observation Carried Forward
用"最后一次观测值"向前填补

原始数据：
─────────────────────────────────────
访视      基线    第1周    第2周    第3周    第4周
血压      160     155      150      ?        ?
                                   ↑        ↑
                                 退出了，没数据

LOCF 填补后：
─────────────────────────────────────
访视      基线    第1周    第2周    第3周    第4周
血压      160     155      150      150      150
                                   ↑        ↑
                             用第2周的值填补
```

### SAP 中的写法

```
5. 缺失数据处理

5.1 主要分析
主要疗效分析采用混合效应重复测量模型（MMRM），
模型中包含治疗组、访视、治疗组×访视交互作用、
基线值及基线×访视交互作用。
该方法在随机缺失（MAR）假设下是有效的。

5.2 敏感性分析
为评估缺失数据对结果的影响，进行以下敏感性分析：

(1) LOCF：用末次观测值填补缺失数据后，
    采用 ANCOVA 分析

(2) 多重插补（MI）：假设缺失数据服从多元正态分布，
    产生 50 个插补数据集，合并结果

(3) 最差情况分析：退出的受试者假设疗效为 0
```

---

## 10. 核心内容详解（四）：多重比较

### 什么是多重比较问题？

```
多重比较问题图解
─────────────────

假设你掷一枚硬币：
• 单次掷出正面的概率 = 50%
• 掷 10 次至少一次正面的概率 = 99.9%

同样的道理：

假设药物真的无效（p 值应该 > 0.05）：
• 检验 1 个指标，假阳性概率 = 5%
• 检验 10 个指标，至少 1 个假阳性概率 = 40%
• 检验 20 个指标，至少 1 个假阳性概率 = 64%

这就是为什么看很多指标时，容易"碰巧"发现"显著"结果！
```

### 为什么需要校正？

```
不校正的问题
─────────────────

假设某新药其实无效，但研究者分析了 20 个疗效指标：

指标 1：p = 0.23 不显著
指标 2：p = 0.45 不显著
指标 3：p = 0.03 显著！★
指标 4：p = 0.67 不显著
...
指标 20：p = 0.04 显著！★

研究者高兴地报告："我们的药在指标 3 和指标 20 上有效！"

但实际上这只是"假阳性"——检验次数多了，总会碰到几个 p < 0.05 的。
```

### 常用校正方法

| 方法 | 原理 | 校正后的标准 | 特点 |
|------|------|-------------|------|
| **Bonferroni** | 把 α 平均分给每个检验 | α/n（如 0.05/5=0.01） | 最严格，可能漏掉真阳性 |
| **Holm** | 分步校正，从小到大 | 逐步放宽标准 | 比 Bonferroni 宽松 |
| **Hochberg** | 分步校正，从大到小 | 逐步收紧标准 | 比 Holm 更宽松 |
| **FDR** | 控制假发现率 | 允许一定比例假阳性 | 最宽松，适合探索性分析 |

### 分层检验策略

```
分层检验（Hierarchical Testing）
──────────────────────────────────

更聪明的做法：事先规定检验顺序

步骤 1：检验主要终点
        ↓ 如果显著
步骤 2：检验关键次要终点 1
        ↓ 如果显著
步骤 3：检验关键次要终点 2
        ↓ 如果显著
步骤 4：检验其他次要终点

规则：只有上一步显著，才检验下一步
优点：不需要调整 α，每步都用 0.05

示例：
• 主要终点 p = 0.02 → 显著 → 继续
• 次要终点 1 p = 0.03 → 显著 → 继续
• 次要终点 2 p = 0.08 → 不显著 → 停止
• 后续终点不再报告 p 值
```

### SAP 中的写法

```
4.1.3 多重性控制

为控制总体 I 类错误率在 0.05 水平，采用分层检验策略：

检验顺序如下：
1. 主要终点：第 4 周 SBP 变化值
2. 关键次要终点：第 4 周 DBP 变化值
3. 关键次要终点：SBP 达标率（< 140 mmHg）

只有当前一个终点检验在 α = 0.05 水平显著时，
才对下一个终点进行正式假设检验。

对于探索性终点，不进行多重性校正，
p 值仅供参考，不用于正式推断。
```

---

## 11. SAP vs Protocol：有什么区别？

### 对比表

| 方面 | Protocol（试验方案） | SAP（统计分析计划） |
|------|---------------------|---------------------|
| **时间** | 试验开始前定稿 | 数据库锁定前定稿 |
| **篇幅** | 50-100+ 页 | 30-80 页 |
| **内容范围** | 整个试验怎么做 | 只关注统计分析 |
| **统计详细程度** | 1-2 页，只写大方向 | 30+ 页，写得非常细 |
| **谁写** | 医学、运营、统计等 | 主要是统计师 |
| **可修改性** | 修改需要伦理审批 | 修改相对灵活（但要在锁定前） |

### 统计部分对比示例

```
Protocol 中的统计描述（简略）
─────────────────────────────

9.4 统计分析方法

主要疗效分析采用协方差分析（ANCOVA），比较两个治疗组
在第 4 周收缩压变化值的差异。模型将包含治疗组、中心
和基线值。显著性水平设为 0.05（双侧）。

缺失数据将采用末次观测值结转（LOCF）方法处理。

（约 200 字）
```

```
SAP 中的统计描述（详细）
─────────────────────────────

4.3 主要疗效分析

4.3.1 主要终点定义
主要终点为第 4 周收缩压（SBP）相对基线的变化值，
计算公式为：CHG = SBP_Week4 - SBP_Baseline

4.3.2 分析人群
全分析集（FAS）

4.3.3 统计模型
采用协方差分析（ANCOVA）模型：

    CHGᵢⱼ = μ + αᵢ + βⱼ + γ·BASEᵢⱼ + εᵢⱼ

其中：
• CHGᵢⱼ：第 i 个治疗组第 j 个中心受试者的变化值
• μ：总体均值
• αᵢ：治疗组效应（i = 1: 新药, 2: 安慰剂）
• βⱼ：中心效应（j = 1, 2, ..., k）
• γ：基线回归系数
• BASEᵢⱼ：基线 SBP 值
• εᵢⱼ：随机误差，假设 εᵢⱼ ~ N(0, σ²)

4.3.4 假设检验
零假设：H₀: α₁ - α₂ = 0（两组疗效无差异）
备择假设：H₁: α₁ - α₂ ≠ 0（两组疗效有差异）
检验水平：α = 0.05（双侧）

4.3.5 估计量与报告内容
• 各治疗组 CHG 的最小二乘均值（LS Mean）
• LS Mean 的标准误（SE）和 95% 置信区间
• 组间差异（新药 - 安慰剂）的点估计
• 组间差异的 95% 置信区间
• 双侧 p 值

4.3.6 模型诊断
• 残差正态性检验（Shapiro-Wilk）
• 方差齐性检验（Levene）
• 如违反假设，将采用稳健方法或非参数方法

（约 1500 字，这只是主要终点部分）
```

### 关系图

```
┌─────────────────────────────────────────────────────────────────┐
│                    Protocol vs SAP 关系                          │
└─────────────────────────────────────────────────────────────────┘

     Protocol（试验方案）
     ┌─────────────────────────────────────────────────────────┐
     │                                                         │
     │  1. 研究背景        ────────────────────────────────    │
     │  2. 研究目的        ────────────────────────────────    │
     │  3. 研究设计        ────────────────────────────────    │
     │  4. 受试者选择      ────────────────────────────────    │
     │  5. 治疗方案        ────────────────────────────────    │
     │  6. 疗效评估        ────────────────────────────────    │
     │  7. 安全性评估      ────────────────────────────────    │
     │  8. 统计方法        ◄──── 只有 1-2 页，很简略           │
     │  9. 数据管理        ────────────────────────────────    │
     │  ...                                                    │
     │                                                         │
     └───────────────────────────┬─────────────────────────────┘
                                 │
                                 │ 详细展开
                                 ▼
     SAP（统计分析计划）
     ┌─────────────────────────────────────────────────────────┐
     │                                                         │
     │  把 Protocol 第 8 章展开成 30-80 页的详细文档            │
     │                                                         │
     │  • 每个终点的具体分析方法                                │
     │  • 统计模型的数学表达式                                  │
     │  • 缺失数据的详细处理方案                                │
     │  • 敏感性分析计划                                        │
     │  • 亚组分析计划                                          │
     │  • 输出表格的模板                                        │
     │  • ...                                                  │
     │                                                         │
     └─────────────────────────────────────────────────────────┘
```

---

## 12. 一个完整的 SAP 示例

以下是一个降压药临床试验 SAP 的简化示例：

```
═══════════════════════════════════════════════════════════════════
                      统计分析计划（SAP）

                  研究编号：XXXBP001
                  研究名称：XX 降压药 III 期临床试验
                  版本：1.0
                  日期：2024-XX-XX
═══════════════════════════════════════════════════════════════════

1. 引言
───────
1.1 研究背景
    本研究是一项随机、双盲、安慰剂对照的 III 期临床试验，
    旨在评估 XX 降压药在轻中度原发性高血压患者中的疗效和安全性。

1.2 研究设计概述
    • 设计类型：随机、双盲、安慰剂对照、平行组
    • 治疗组：XX 降压药 10mg vs 安慰剂
    • 治疗周期：4 周
    • 计划样本量：200 例（每组 100 例）

2. 研究终点
───────────
2.1 主要终点
    第 4 周坐位收缩压（SBP）相对基线的变化值

2.2 关键次要终点（按检验顺序）
    (1) 第 4 周坐位舒张压（DBP）相对基线的变化值
    (2) 第 4 周 SBP 达标率（SBP < 140 mmHg）

2.3 其他次要终点
    • 各访视点 SBP 和 DBP 的变化值
    • SBP 和 DBP 的反应率（下降 ≥ 10 mmHg）

2.4 安全性终点
    • 不良事件发生率
    • 实验室检查异常

3. 分析人群
───────────
3.1 全分析集（FAS）
    定义：所有随机化的受试者，至少服用过一次研究药物，
         且至少有一次基线后 SBP 评估数据。
    用途：主要疗效分析

3.2 符合方案集（PPS）
    定义：FAS 中符合以下条件的受试者：
         • 完成 4 周治疗
         • 无重大方案违背
         • 用药依从性 ≥ 80%
    用途：敏感性分析

3.3 安全性分析集（SS）
    定义：所有至少服用过一次研究药物的受试者
    用途：安全性分析

4. 统计方法
───────────
4.1 一般原则
    • 所有统计检验采用双侧检验，显著性水平 α = 0.05
    • 置信区间采用 95% 置信水平
    • 连续变量描述：n, Mean, SD, Median, Min, Max
    • 分类变量描述：n, %

4.2 主要疗效分析

    4.2.1 分析方法
    采用协方差分析（ANCOVA）：

        CHG = TRT + CENTER + BASE

    其中：
    • CHG：第 4 周 SBP 变化值
    • TRT：治疗组（固定效应）
    • CENTER：中心（固定效应）
    • BASE：基线 SBP（协变量）

    4.2.2 报告内容
    • 各组 LS Mean 及 95% CI
    • 组间差异及 95% CI
    • 双侧 p 值

4.3 次要疗效分析

    4.3.1 连续变量（DBP 变化值等）
    方法同主要终点，采用 ANCOVA

    4.3.2 分类变量（达标率等）
    采用 Cochran-Mantel-Haenszel 检验，按中心分层

4.4 多重性控制
    采用分层检验策略，检验顺序：
    主要终点 → 关键次要终点 1 → 关键次要终点 2

    只有前一终点 p < 0.05，才检验下一终点。

4.5 安全性分析
    • 不良事件按系统器官分类（SOC）和首选术语（PT）汇总
    • 采用描述性统计，不进行假设检验

5. 缺失数据处理
───────────────
5.1 主要分析
    采用混合效应重复测量模型（MMRM），无需填补缺失数据

5.2 敏感性分析
    (1) LOCF：末次观测值结转
    (2) BOCF：基线值结转（保守分析）
    (3) 多重插补（MI）

6. 敏感性分析
─────────────
• PPS 人群重复主要分析
• 不同缺失数据处理方法
• 排除重大方案违背的分析

7. 亚组分析
───────────
预设亚组（交互作用检验）：
• 性别（男 vs 女）
• 年龄（< 65 岁 vs ≥ 65 岁）
• 基线 SBP（< 160 vs ≥ 160 mmHg）

8. 统计输出
───────────
8.1 表格清单
    表 14.1.1   受试者分布
    表 14.1.2   人口学特征
    表 14.2.1   主要疗效分析 - SBP 变化值
    表 14.2.2   次要疗效分析 - DBP 变化值
    表 14.3.1   不良事件汇总
    ...

8.2 图形清单
    图 14.2.1   SBP 随时间变化趋势图
    图 14.2.2   SBP 变化值森林图（亚组分析）
    ...

═══════════════════════════════════════════════════════════════════
                           文档结束
═══════════════════════════════════════════════════════════════════
```

---

## 13. SAP 的时间节点

### 关键里程碑

```
SAP 开发时间线
─────────────────────────────────────────────────────────────────

Phase        │  试验启动    试验进行中      DBL前        DBL后
             │     │           │            │            │
─────────────┼─────┴───────────┴────────────┴────────────┴─────
             │
SAP 草稿     │  ▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
开始起草     │
             │
SAP 内部审核 │  ░░░░░░░░░▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░
统计团队审核 │
             │
SAP 定稿     │  ░░░░░░░░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░
签字批准     │                              ↑
             │                         必须在此之前完成！
             │
数据库锁定   │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█░░░░░░░░░░░░░
(DBL)        │                                │
             │                                │
执行 SAP     │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓
统计分析     │

图例：▓ = 活动进行中   █ = 关键节点   ░ = 无活动
```

### 时间建议

| 里程碑 | 建议时间 | 说明 |
|--------|---------|------|
| 开始起草 | 首例入组后 | 可与试验并行进行 |
| 初稿完成 | 入组 50% 时 | 预留足够审核时间 |
| 内部审核 | 入组 75% 时 | 统计、医学、运营团队审核 |
| **定稿签字** | **DBL 前 1-2 周** | 必须赶在锁定前 |
| 执行分析 | DBL 后立即开始 | 严格按 SAP 执行 |

---

## 14. 常见问题

### Q1: SAP 是在试验设计阶段就有的吗？不应该是数据处理阶段才产出的吗？

这是一个很常见的误解。**SAP 确实是在试验设计阶段就开始制定的**，而不是等到数据处理阶段才产出。

```
SAP 的时间线
────────────────────────────────────────────────────────

Protocol 定稿 ──► 试验开始前
SAP 起草 ────────► 试验开始后即可开始
SAP 定稿 ────────► 数据库锁定前（但规划在设计阶段就开始）
```

**为什么 SAP 属于试验设计阶段？**

1. **提前规划的原则**：SAP 需要在看到数据之前就定义好分析方法，这是为了避免"数据驱动"的分析偏倚（即看了数据再决定怎么分析）

2. **与 Protocol 的关系**：
   - Protocol 定义"试验怎么做"
   - SAP 定义"数据怎么分析"
   - 两者都是在试验执行前就需要**规划**好的

3. **ICH E9 指南要求**：统计分析计划应在揭盲前完成，且关键分析方法应在 Protocol 中预先指定

**SAP 的版本演进**：

| 阶段 | SAP 状态 | 说明 |
|------|----------|------|
| 试验设计阶段 | 起草 SAP 草稿 | 基于 Protocol 中的统计部分展开 |
| 试验执行阶段 | 根据需要更新 SAP | 细化分析方法，但不改变核心策略 |
| 数据库锁定前 | SAP 最终定稿 | 必须在此时完成签字 |
| 数据库锁定后 | 按 SAP 执行分析 | 不得修改主要分析方法 |

所以，虽然 SAP 的**最终定稿**是在"数据库锁定前"，但它的**起草和规划**确实是在试验设计阶段就开始的。将 SAP 归类到"试验设计阶段"，强调的是**规划**的时机，而不是最终完成的时机。

### Q2: SAP 必须在什么时候完成？

**必须在数据库锁定（DBL）之前定稿。** 这是核心原则。如果锁定后才写 SAP，就失去了"预先规定"的意义，可能被质疑是根据数据结果来制定分析方法。

### Q3: SAP 定稿后可以修改吗？

可以，但要走正式流程：
- 锁定前修改：记录修改原因，更新版本号
- 锁定后修改：必须有充分理由，记录在 SAP 修正案中，并在 CSR 中说明

### Q4: 谁来写 SAP？

主要是**统计师（生物统计学家）**，但需要与以下人员沟通：
- 医学团队：确认终点定义、临床意义
- 数据管理：确认数据结构、变量定义
- 编程团队：确认可执行性

### Q5: SAP 和 ADaM 什么关系？

```
SAP 规定"怎么分析" → ADaM 是"分析用的数据"

SAP 写：主要终点是 SBP 变化值，用 ANCOVA 分析
        ↓
ADaM 做：在 ADVS 数据集中创建 CHG（变化值）、BASE（基线）等变量
        ↓
TLF 程序：读取 ADVS，按 SAP 规定的方法做 ANCOVA，输出表格

SAP 是"计划"，ADaM 是"数据"，TLF 是"结果"
```

### Q6: 不同终点可以用不同的分析人群吗？

可以，而且很常见：
- 疗效分析：通常用 FAS/ITT
- 敏感性分析：通常用 PPS
- 安全性分析：通常用 SS

但必须在 SAP 中预先规定清楚。

### Q7: 探索性分析需要写在 SAP 里吗？

建议写，但可以比较简略。探索性分析的目的是"发现线索"而非"验证假设"，所以：
- 不需要多重性校正
- p 值仅供参考
- 结论需要后续研究验证

---

## 15. 总结

### 一图看懂 SAP

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│                         SAP 核心要点                                │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   是什么？    统计分析计划 —— 数据分析的"游戏规则书"                  │
│                                                                     │
│   为什么？    防止数据操纵，保证分析过程公正透明                       │
│                                                                     │
│   什么时候？  必须在数据库锁定前定稿                                  │
│                                                                     │
│   谁来写？    统计师主导，多团队配合                                  │
│                                                                     │
│   写什么？    ┌─────────────────────────────────────┐              │
│              │  • 分析人群（谁纳入分析）              │              │
│              │  • 统计方法（怎么分析）                │              │
│              │  • 缺失处理（数据不全怎么办）          │              │
│              │  • 多重校正（多指标怎么控制错误）      │              │
│              │  • 敏感性分析（结论稳健吗）            │              │
│              │  • 输出规格（表格图形长什么样）        │              │
│              └─────────────────────────────────────┘              │
│                                                                     │
│   和谁配合？  Protocol → SAP → ADaM → TLFs → CSR                    │
│              试验方案    分析计划  分析数据  统计输出  临床报告       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 关键要点

1. **SAP 是"规则"，不是"结果"** —— 在看到数据前就要写好
2. **必须在数据库锁定前完成** —— 这是铁律
3. **越详细越好** —— 减少事后争议
4. **由统计师主导** —— 但需要多团队配合
5. **是提交包的必要组成部分** —— 药监局会审查

### 一句话记住 SAP

> **SAP 就是在"开奖"之前，先把"中奖规则"写清楚，防止有人事后改规则说自己中奖了。**

---

## 附录：SAP 常用术语表

| 术语 | 英文 | 含义 |
|------|------|------|
| SAP | Statistical Analysis Plan | 统计分析计划 |
| FAS | Full Analysis Set | 全分析集 |
| ITT | Intention-to-Treat | 意向治疗 |
| PPS | Per-Protocol Set | 符合方案集 |
| SS | Safety Set | 安全性分析集 |
| ANCOVA | Analysis of Covariance | 协方差分析 |
| MMRM | Mixed Model for Repeated Measures | 混合效应重复测量模型 |
| LOCF | Last Observation Carried Forward | 末次观测值结转 |
| MI | Multiple Imputation | 多重插补 |
| DBL | Database Lock | 数据库锁定 |
| LS Mean | Least Squares Mean | 最小二乘均值 |
| CI | Confidence Interval | 置信区间 |

---

> 📚 **相关阅读**
> - [SDTM/ADaM 入门教程](./SDTM_ADaM_Tutorial.md)
> - [药监局提交包指南](./Submission_Package_Guide.md)
> - [新药研发数据处理概述](./Drug_Development_Data_Overview.md)

---

*本文档由 AI 辅助生成，如有疑问请咨询专业人士。*
